# Анализ проекта: MISSION Canvas

MISSION Canvas - это методология для структурированного анализа проектов в области Data Science и Machine Learning. Аббревиатура расшифровывается как: **Metrics, Implementation, Sustainability, Stakeholders, Inputs, Output, Navigation**.

---

## M - Metrics (Метрики)

### Метрики машинного обучения

**Основная метрика оптимизации:**
- **F2-Score** - гармоническое среднее с акцентом на Recall

**Обязательные ограничения:**
- **Recall** ≥ 0.98 (выявление 98% мошеннических транзакций)
- **False Positive Rate** < 0.05 (не более 5% ложных блокировок)

**Дополнительные метрики мониторинга:**
- Precision
- ROC-AUC
- PR-AUC (важно для несбалансированных данных)
- Confusion Matrix

### Бизнес-метрики

**Финансовые:**
- Предотвращенный ущерб: целевое значение - снижение потерь до ≤ 500 тыс. руб/месяц
- ROI проекта: окупаемость инвестиций в 10 млн руб.
- Стоимость ложного срабатывания (в терминах оттока клиентов)

**Операционные:**
- Количество заблокированных легитимных транзакций в день
- Количество пропущенных мошеннических транзакций в день
- Доля мошеннических транзакций от общего числа (должна быть ≤ 2%)

### Технические метрики

**Производительность:**
- Latency (время ответа): < 100 мс на транзакцию (prod), < 200 мс (MVP)
- Throughput: до 400 транзакций/сек в пике
- Доступность (Availability): 99.9% (SLA)

**Качество системы:**
- Model drift: отслеживание деградации модели
- Data drift: мониторинг изменений в распределении данных
- Время переобучения модели: < 24 часов

---

## I - Implementation (Реализация)

### Технологический стек

**ML & Data Processing:**
- **Язык**: Python 3.9+
- **ML библиотеки**: scikit-learn, XGBoost, LightGBM, CatBoost
- **Feature engineering**: pandas, numpy, feature-engine
- **Балансировка классов**: imbalanced-learn (SMOTE, ADASYN)

**Инфраструктура:**
- **API**: FastAPI (высокая производительность, асинхронность)
- **Контейнеризация**: Docker
- **Оркестрация**: Kubernetes (для масштабирования)
- **Облачный провайдер**: Yandex Cloud / AWS / GCP (на выбор)

**MLOps:**
- **Эксперименты**: MLflow / Weights & Biases
- **Версионирование данных**: DVC
- **CI/CD**: GitHub Actions
- **Мониторинг**: Prometheus + Grafana
- **Логирование**: ELK Stack (Elasticsearch, Logstash, Kibana)

**Безопасность:**
- Шифрование данных в покое и при передаче
- Управление секретами: HashiCorp Vault / AWS Secrets Manager
- Анонимизация PII при логировании

### Архитектура решения

**Уровень 1: Data Pipeline**
- Прием CSV файлов с транзакциями
- Валидация и предобработка данных
- Feature extraction

**Уровень 2: Model Serving**
- REST API для real-time inference
- Batch processing для исторических данных
- Model versioning и A/B тестирование

**Уровень 3: Monitoring & Feedback**
- Сбор метрик производительности
- Детектирование drift
- Сбор feedback для переобучения

### Подход к разработке

**Методология**: Agile / Scrum
- Спринты по 2 недели
- Daily standups для синхронизации команды
- Демо результатов каждые 2 недели

**Этапы реализации:**
1. **Месяцы 1-3 (MVP)**: baseline модель + inference pipeline
2. **Месяцы 4-5**: оптимизация, A/B тесты
3. **Месяц 6**: production deployment и стабилизация

---

## S - Sustainability (Устойчивость)

### Поддержка модели в production

**Мониторинг качества:**
- Ежедневный анализ метрик (Recall, FPR, F2)
- Автоматические алерты при деградации > 5%
- Dashboard для визуализации трендов

**Стратегия переобучения:**
- Scheduled retraining: раз в 2 недели
- Triggered retraining: при детектировании drift или падении метрик
- Постепенный rollout новых моделей (canary deployment)

### Управление дрейфом

**Data Drift:**
- Мониторинг распределений признаков (KS-тест, Chi-square)
- Сравнение статистик train vs production данных
- Алерты при значительных изменениях

**Concept Drift:**
- Отслеживание изменения паттернов мошенничества
- Feedback loop: анализ ложных предсказаний
- Быстрая адаптация к новым типам fraud

**Model Drift:**
- Tracking метрик модели на валидационном сете
- Shadow mode testing для новых версий
- Rollback механизм при ухудшении качества

### Финансовая устойчивость

**Бюджет на поддержку (после запуска):**
- Облачная инфраструктура: ~200-300 тыс. руб/месяц
- Заработная плата команды: ~500-800 тыс. руб/месяц
- Резерв на непредвиденные расходы: 10% от бюджета

**Окупаемость:**
- При предотвращении ущерба в 500 тыс. руб/месяц
- Окупаемость первоначальных инвестиций (10 млн): ~12-15 месяцев
- Дальнейшая экономия: 100-200 тыс. руб/месяц

---

## S - Stakeholders (Заинтересованные стороны)

### Внутренние стейкхолдеры

**Руководство банка:**
- **Интересы**: снижение финансовых потерь, конкурентоспособность
- **Ожидания**: быстрая окупаемость, минимальные риски
- **Коммуникация**: ежемесячные статус-репорты, KPI dashboard

**IT-департамент:**
- **Интересы**: надежность системы, легкость интеграции
- **Ожидания**: документация, соблюдение стандартов безопасности
- **Коммуникация**: технические встречи, API документация

**Служба безопасности / Fraud Analysts:**
- **Интересы**: эффективное выявление мошенничества
- **Ожидания**: инструменты для анализа, прозрачность решений модели
- **Коммуникация**: регулярные синхронизации, training сессии

**Отдел клиентского сервиса:**
- **Интересы**: минимизация жалоб клиентов на ложные блокировки
- **Ожидания**: быстрая разблокировка, понятные объяснения
- **Коммуникация**: feedback loop, инструкции для поддержки

**Юридический отдел / Compliance:**
- **Интересы**: соответствие законодательству (152-ФЗ, ПОД/ФТ)
- **Ожидания**: аудит системы, privacy by design
- **Коммуникация**: юридическая экспертиза, аудит логов

### Внешние стейкхолдеры

**Клиенты банка:**
- **Интересы**: безопасность средств, удобство использования
- **Ожидания**: защита от мошенников, отсутствие ложных блокировок
- **Риски**: отток при FPR > 5%

**Регуляторы (ЦБ РФ):**
- **Интересы**: финансовая стабильность, защита прав потребителей
- **Ожидания**: соблюдение нормативов, отчетность
- **Коммуникация**: регулярная отчетность

**Облачный провайдер:**
- **Интересы**: стабильность сервиса, соблюдение SLA
- **Ожидания**: эффективное использование ресурсов
- **Коммуникация**: техническая поддержка, мониторинг затрат

### Управление ожиданиями

**Критические моменты:**
1. Объяснить руководству, что 100% точность невозможна
2. Настроить реалистичные KPI для MVP (более мягкие, чем для prod)
3. Создать процесс для быстрой обработки жалоб на ложные срабатывания
4. Обеспечить explainability решений модели для аудита

---

## I - Inputs (Входные данные)

### Источники данных

**Первичный источник: CSV файлы транзакций**

**Структура данных (предполагаемая):**

**Информация о транзакции:**
- Transaction ID (уникальный идентификатор)
- Timestamp (дата и время)
- Amount (сумма транзакции)
- Currency (валюта)
- Transaction type (тип операции: перевод, оплата и т.д.)
- Merchant category code (категория получателя)
- Payment method (способ оплаты)

**Информация о клиенте:**
- Customer ID (анонимизированный)
- Account age (возраст аккаунта)
- Customer segment (сегмент клиента)
- Historical transaction count (история операций)

**Геоданные:**
- IP address / Device location
- Country, City
- Distance from usual location

**Технические данные:**
- Device type (мобильное устройство, веб)
- Device fingerprint
- Session information

**Целевая переменная:**
- is_fraud (0 - легитимная, 1 - мошенническая)

### Качество данных

**Ожидаемые проблемы:**
- ❌ Missing values (пропущенные значения)
- ❌ Несбалансированность классов (~2% fraud)
- ❌ Шум в метках (ошибки разметки)
- ❌ Выбросы в числовых признаках
- ❌ Временной дрейф (изменение паттернов со временем)

**Меры по контролю качества:**
1. **Валидация схемы данных** (Great Expectations / Pandera)
2. **Обработка пропусков** (импутация / удаление)
3. **Детектирование выбросов** (IQR, Isolation Forest)
4. **Мониторинг консистентности** между файлами

### Требования к данным

**Объем данных для обучения:**
- Минимум: 6 месяцев исторических данных
- Рекомендуемо: 12-24 месяца
- Количество транзакций: > 10 млн (чтобы иметь ~200К fraud примеров)

**Обновление данных:**
- Новые данные поступают периодически (партиями)
- Frequency: ежедневно / еженедельно
- Необходим pipeline для инкрементного обновления

### Конфиденциальность и безопасность

**Меры защиты:**
1. Шифрование данных при хранении (at rest) и передаче (in transit)
2. Анонимизация PII (Personally Identifiable Information)
3. Access control: только авторизованные сотрудники
4. Аудит логов доступа к данным
5. Data masking в dev/test окружениях
6. Соблюдение 152-ФЗ "О персональных данных"

**DLP (Data Loss Prevention):**
- Запрет на скачивание данных на локальные машины
- Работа в защищенных облачных окружениях
- Регулярные security audits

---

## O - Output (Выходные данные)

### Основной output: Предсказание модели

**Формат:**
```json
{
  "transaction_id": "TXN123456789",
  "fraud_probability": 0.87,
  "fraud_prediction": 1,
  "risk_level": "HIGH",
  "decision": "BLOCK",
  "timestamp": "2025-11-12T14:30:00Z",
  "model_version": "v1.2.3"
}
```

**Поля:**
- `fraud_probability`: вероятность мошенничества [0, 1]
- `fraud_prediction`: бинарное решение (0/1)
- `risk_level`: категория риска (LOW / MEDIUM / HIGH / CRITICAL)
- `decision`: действие системы (ALLOW / FLAG / BLOCK / MANUAL_REVIEW)

### Вторичные outputs

**Для fraud analysts (расширенный response):**
```json
{
  "transaction_id": "TXN123456789",
  "fraud_probability": 0.87,
  "fraud_prediction": 1,
  "risk_factors": [
    {"feature": "unusual_location", "importance": 0.35},
    {"feature": "high_amount", "importance": 0.28},
    {"feature": "new_device", "importance": 0.22}
  ],
  "similar_cases": ["TXN987654321", "TXN456789123"],
  "recommended_action": "MANUAL_REVIEW"
}
```

**Для мониторинга и аналитики:**
- Агрегированные метрики (hourly, daily)
- Статистика ошибок (FP, FN)
- Drift reports
- Performance metrics (latency, throughput)

### Интеграция с существующими системами

**API Endpoint:**
```
POST /api/v1/fraud-detection/predict
```

**Batch processing endpoint:**
```
POST /api/v1/fraud-detection/batch-predict
```

**Webhook для уведомлений:**
- Критические случаи (high-value fraud detection)
- Алерты о деградации модели

### Хранение результатов

**Короткосрочное (операционное):**
- In-memory cache (Redis) для быстрого доступа
- TTL: 24 часа

**Долгосрочное (аналитическое):**
- Data warehouse (ClickHouse / PostgreSQL)
- Партиционирование по дате
- Retention policy: 2 года (для аудита и ретроспективного анализа)

### Explainability (объяснимость)

**Для регуляторных требований:**
- SHAP values для каждого предсказания
- Feature importance rankings
- Counterfactual explanations ("что нужно изменить, чтобы транзакция была легитимной")

**Визуализация:**
- Dashboard с топ-признаками, влияющими на решение
- Примеры похожих случаев из истории

---

## N - Navigation (Навигация / Риски)

### Ключевые риски проекта

#### Технические риски

**Риск 1: Низкое качество модели**
- **Вероятность**: средняя
- **Влияние**: критическое
- **Митигация**: 
  - Тщательный EDA и feature engineering
  - Эксперименты с несколькими алгоритмами
  - Привлечение экспертов (fraud analysts) для domain knowledge
  - Использование ансамблей моделей

**Риск 2: Производительность не соответствует требованиям**
- **Вероятность**: средняя
- **Влияние**: высокое
- **Митигация**:
  - Ранее тестирование latency на MVP
  - Оптимизация inference (ONNX, pruning, quantization)
  - Горизонтальное масштабирование
  - Использование легковесных моделей (LightGBM вместо XGBoost)

**Риск 3: Model / Data drift**
- **Вероятность**: высокая (паттерны мошенничества меняются)
- **Влияние**: критическое
- **Митигация**:
  - Robust мониторинг drift
  - Автоматическое переобучение
  - A/B тестирование новых версий
  - Feedback loop с fraud analysts

#### Бизнес-риски

**Риск 4: Превышение FPR → отток клиентов**
- **Вероятность**: средняя
- **Влияние**: критическое
- **Митигация**:
  - Строгий контроль FPR на всех этапах
  - Настройка порога классификации
  - Механизм быстрой разблокировки
  - A/B тест перед полным rollout

**Риск 5: Недостаточный budget / ресурсы**
- **Вероятность**: низкая
- **Влияние**: высокое
- **Митигация**:
  - Детальное планирование расходов
  - Использование cost-effective облачных решений
  - Оптимизация использования ресурсов
  - Резерв в бюджете на непредвиденные расходы

**Риск 6: Срыв сроков (MVP / Production)**
- **Вероятность**: средняя
- **Влияние**: высокое
- **Митигация**:
  - Agile методология с короткими спринтами
  - Четкая приоритизация задач (MoSCoW)
  - Буфер времени в планировании (20%)
  - Еженедельные checkpoints с заказчиком

#### Риски безопасности и compliance

**Риск 7: Утечка конфиденциальных данных**
- **Вероятность**: низкая
- **Влияние**: катастрофическое
- **Митигация**:
  - Строгие политики безопасности
  - Encryption at rest and in transit
  - Regular security audits
  - Минимизация доступа к production данным
  - GDPR/152-ФЗ compliance

**Риск 8: Несоответствие регуляторным требованиям**
- **Вероятность**: низкая
- **Влияние**: критическое
- **Митигация**:
  - Консультации с юридическим отделом
  - Audit trail для всех решений модели
  - Explainability решений
  - Документация процессов

#### Организационные риски

**Риск 9: Отсутствие необходимых компетенций в команде**
- **Вероятность**: средняя
- **Влияние**: высокое
- **Митигация**:
  - Оценка компетенций на старте
  - Привлечение внешних консультантов
  - Обучение команды
  - Найм недостающих специалистов

**Риск 10: Resistance to change от стейкхолдеров**
- **Вероятность**: средняя
- **Влияние**: среднее
- **Митигация**:
  - Вовлечение стейкхолдеров с начала проекта
  - Демонстрация early wins (quick wins)
  - Обучение сотрудников работе с системой
  - Change management стратегия

### Критерии прекращения проекта (Stop criteria)

Проект следует остановить, если на этапе MVP (3 месяца):

1. ❌ F2-Score < 0.75 (даже после multiple итераций)
2. ❌ Невозможно достичь Recall > 0.90
3. ❌ Latency > 500 мс (и нет путей оптимизации)
4. ❌ Затраты превышают бюджет на 50%+
5. ❌ Серьезные проблемы с безопасностью данных, которые невозможно решить

### Success metrics для navigation

**Green zone (успех):**
- MVP через 3 месяца с F2 > 0.85
- Положительный feedback от fraud analysts
- Инфраструктура работает stable
- On budget и on schedule

**Yellow zone (предупреждение):**
- Небольшие задержки в сроках (<2 недель)
- Метрики чуть ниже целевых (но есть план улучшения)
- Бюджет превышен на 10-20%

**Red zone (критично):**
- Отставание > 1 месяца от roadmap
- Метрики значительно хуже целевых
- Серьезные технические / безопасности проблемы
- Бюджет превышен > 30%

### План реагирования

**При попадании в Yellow zone:**
1. Root cause analysis проблем
2. Escalation к руководству
3. Корректировка плана / бюджета
4. Приоритизация критичных задач

**При попадании в Red zone:**
1. Срочное совещание с заказчиком
2. Оценка целесообразности продолжения
3. Радикальный pivot (изменение подхода)
4. Или принятие решения о прекращении проекта

---

## Заключение

Проведенный анализ по методологии MISSION Canvas позволил:

1. ✅ **Формализовать метрики** успеха проекта (F2-Score, Recall, FPR)
2. ✅ **Определить технологический стек** и подход к реализации
3. ✅ **Разработать стратегию устойчивости** системы в production
4. ✅ **Идентифицировать стейкхолдеров** и их требования
5. ✅ **Описать входные и выходные данные** системы
6. ✅ **Оценить риски** проекта и способы их митигации

Этот анализ формирует solid foundation для успешной реализации антифрод-системы и позволяет заранее предусмотреть потенциальные проблемы.
