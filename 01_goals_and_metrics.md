# Цели проекта и выбор метрик ML

## 1. Формализация целей антифрод-системы

### 1.1 Бизнес-цели

#### Главная цель
**Минимизация финансовых потерь клиентов банка от мошеннических онлайн-транзакций при сохранении качества пользовательского опыта.**

#### Декомпозиция бизнес-целей

**Цель 1: Финансовая эффективность**
- Снизить общий ущерб от мошеннических операций до уровня ≤ 500 тыс. руб/месяц (паритет с конкурентами)
- Окупить инвестиции в проект (10 млн руб.) за счет предотвращения потерь

**Цель 2: Операционное качество**
- Обнаруживать не менее 98% мошеннических транзакций (если исходить из того, что у конкурентов проходит не более 2 из 100)
- Минимизировать количество ложных блокировок корректных транзакций (< 5% от всех транзакций)

**Цель 3: Конкурентоспособность**
- Достичь показателей качества не хуже конкурентов
- Обеспечить скорость работы системы, достаточную для обработки пиковых нагрузок (400 транзакций/сек)

**Цель 4: Удержание клиентов**
- Предотвратить отток клиентов из-за неудобства использования сервиса
- Повысить доверие клиентов к безопасности платежной системы

### 1.2 Технические цели

**Цель 1: Производительность**
- Время ответа системы (inference): < 100 мс на одну транзакцию
- Пропускная способность: до 400 транзакций/сек
- Доступность системы (SLA): 99.9%

**Цель 2: Качество модели**
- Точность обнаружения мошенничества: Recall ≥ 0.98 для мошеннических транзакций
- Минимизация ложных срабатываний: FPR < 0.05

**Цель 3: Масштабируемость**
- Возможность горизонтального масштабирования для обработки возросших нагрузок
- Модульная архитектура для упрощения развития системы

**Цель 4: Безопасность**
- Обеспечение конфиденциальности данных клиентов
- Соответствие требованиям по защите персональных данных (152-ФЗ)

**Цель 5: Управляемость**
- Возможность мониторинга качества модели в реальном времени
- Механизмы для быстрого переобучения модели при деградации качества

### 1.3 Проектные цели

**MVP (3 месяца)**
- Разработать работающий прототип системы
- Провести первичное тестирование на исторических данных
- Оценить техническую и финансовую целесообразность проекта

**Production (6 месяцев)**
- Внедрить систему в production среду
- Обеспечить интеграцию с существующими системами банка
- Настроить процессы мониторинга и поддержки

---

## 2. Выбор метрики машинного обучения

### 2.1 Анализ задачи

Задача относится к классу **бинарной классификации с несбалансированными классами**:
- Класс 0: легитимная транзакция (majority class, ~98%)
- Класс 1: мошенническая транзакция (minority class, ~2%)

### 2.2 Специфика задачи

**Асимметрия ошибок:**

| Тип ошибки | Название | Последствие | Критичность |
|------------|----------|-------------|-------------|
| False Positive (FP) | Легитимную транзакцию пометили как мошенническую | Недовольство клиента, возможный отток | **Высокая** (ограничение < 5%) |
| False Negative (FN) | Мошенническую транзакцию пропустили | Финансовые потери клиента и репутационные риски | **Критическая** |

**Вывод**: Обе ошибки критичны, но имеют разные ограничения.

### 2.3 Кандидаты метрик

#### Precision (Точность)
```
Precision = TP / (TP + FP)
```
- Показывает, какая доля транзакций, помеченных как мошеннические, действительно мошеннические
- **Минус**: не учитывает пропущенные мошеннические транзакции (FN)

#### Recall (Полнота, True Positive Rate)
```
Recall = TP / (TP + FN)
```
- Показывает, какую долю мошеннических транзакций система смогла обнаружить
- **Требование**: Recall ≥ 0.98 (обнаружить не менее 98% мошенничества)

#### False Positive Rate
```
FPR = FP / (FP + TN)
```
- Показывает, какую долю легитимных транзакций система ошибочно заблокирует
- **Требование**: FPR < 0.05 (не более 5% ложных блокировок)

#### F1-Score
```
F1 = 2 * (Precision * Recall) / (Precision + Recall)
```
- Гармоническое среднее Precision и Recall
- **Минус**: одинаково взвешивает обе метрики, но у нас разные требования к ним

#### F-beta Score
```
F_beta = (1 + beta²) * (Precision * Recall) / (beta² * Precision + Recall)
```
- Позволяет регулировать важность Recall относительно Precision через параметр beta
- При beta > 1 больше внимания уделяется Recall

### 2.4 Выбор основной метрики

**Рекомендуемая метрика: F2-Score**

#### Обоснование:

1. **F2-Score** уделяет в 2 раза больше внимания Recall, чем Precision:
   ```
   F2 = 5 * (Precision * Recall) / (4 * Precision + Recall)
   ```

2. **Соответствует бизнес-приоритетам**:
   - Пропуск мошенничества (↓Recall) → критичные финансовые потери
   - Ложная блокировка (↓Precision) → недовольство клиента, но не потеря денег

3. **Учитывает оба типа ошибок**, но с правильными весами

4. **Подходит для несбалансированных классов**, в отличие от Accuracy

### 2.5 Дополнительные метрики для мониторинга

Для полноценной оценки системы необходимо отслеживать:

**Обязательные метрики**:
1. **Recall** (TPR) - должен быть ≥ 0.98
2. **False Positive Rate** - должен быть < 0.05
3. **F2-Score** - целевая метрика для оптимизации

**Вспомогательные метрики**:
4. **Precision** - для понимания точности предсказаний
5. **ROC-AUC** - общее качество разделения классов
6. **PR-AUC** (Precision-Recall AUC) - лучше подходит для несбалансированных данных
7. **Confusion Matrix** - детальный анализ ошибок

**Бизнес-метрики**:
8. **Предотвращенный ущерб** (руб/месяц)
9. **Количество заблокированных легитимных транзакций** (шт/день)
10. **Среднее время обработки транзакции** (мс)

### 2.6 Пороговая стратегия

Модель должна выдавать вероятность мошенничества. Порог принятия решения следует выбрать так, чтобы:

1. **Обеспечить Recall ≥ 0.98** (главное требование)
2. **При этом минимизировать FPR** (ограничение < 0.05)

Формальная постановка:
```
threshold = argmax(F2-Score) 
при ограничениях:
  - Recall ≥ 0.98
  - FPR < 0.05
```

### 2.7 Стратегия обучения модели

**Целевая функция оптимизации**: максимизация F2-Score

**Подходы к работе с дисбалансом**:
1. Использование class_weight для увеличения штрафа за FN
2. SMOTE или другие техники балансировки
3. Ансамблирование методов
4. Корректировка порога классификации post-hoc

**Валидация**:
- Кросс-валидация с сохранением распределения классов (StratifiedKFold)
- Отдельный hold-out тестовый набор для финальной оценки
- Временное разбиение данных (если есть временная структура)

---

## 3. Критерии успеха проекта

### MVP (3 месяца)
- ✅ F2-Score ≥ 0.85 на тестовых данных
- ✅ Recall ≥ 0.95
- ✅ FPR < 0.07
- ✅ Время inference < 200 мс

### Production (6 месяцев)
- ✅ F2-Score ≥ 0.90
- ✅ Recall ≥ 0.98
- ✅ FPR < 0.05
- ✅ Время inference < 100 мс
- ✅ Обработка до 400 транзакций/сек
- ✅ Ущерб ≤ 500 тыс. руб/месяц

---

## 4. Заключение

Выбранная метрика **F2-Score** и определенные ограничения на **Recall (≥ 0.98)** и **FPR (< 0.05)** позволят:

1. Обеспечить высокое качество обнаружения мошенничества
2. Минимизировать негативный пользовательский опыт
3. Достичь конкурентоспособности на рынке
4. Выполнить финансовые цели проекта

Такой подход сбалансирован с точки зрения бизнес-требований и математически корректен для решения задачи классификации с несбалансированными классами.
